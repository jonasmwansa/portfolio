{% extends 'portfolio/base.html' %}
{% load static %}

{% block title %}Contact - Jonas | Get In Touch{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Page Header -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="display-4 fw-bold mb-3">Get In Touch</h1>
            <p class="lead text-muted">Ready to start your next project? Let's talk!</p>
        </div>
    </div>

    <div class="row">
        <!-- Contact Information -->
        <div class="col-lg-4 mb-4 animate-in">
            <div class="card card-custom h-100">
                <div class="card-body">
                    <h4 class="card-title mb-4">Contact Information</h4>
                    
                    <div class="contact-info mb-4">
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-envelope text-primary me-3 fa-lg"></i>
                            <div>
                                <h6 class="mb-1">Email</h6>
                                <p class="text-muted mb-0">jonasmwansa7@gmail.com</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-phone text-primary me-3 fa-lg"></i>
                            <div>
                                <h6 class="mb-1">Phone</h6>
                                <p class="text-muted mb-0">+260 968 555 983</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-map-marker-alt text-primary me-3 fa-lg"></i>
                            <div>
                                <h6 class="mb-1">Location</h6>
                                <p class="text-muted mb-0">Lusaka, Zambia</p>
                            </div>
                        </div>
                        
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-building text-primary me-3 fa-lg"></i>
                            <div>
                                <h6 class="mb-1">Current Role</h6>
                                <p class="text-muted mb-0">Applications Developer at ECZ</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="social-links">
                        <h6 class="mb-3">Professional Profiles</h6>
                        <div class="d-flex gap-3">
                            <a href="https://github.com/jonasmwansa" class="social-icon"><i class="fab fa-github fa-2x"></i></a>
                            <a href="https://www.linkedin.com/in/jonas-mwansa-787259155/" class="social-icon"><i class="fab fa-linkedin fa-2x"></i></a>
                            <a href="https://twitter.com/jonas18939942" class="social-icon"><i class="fab fa-twitter fa-2x"></i></a>
                            <a href="{% url 'portfolio:home' %}" class="social-icon"><i class="fab fa-dev fa-2x"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Form -->
        <div class="col-lg-8 animate-in">
            <div class="card card-custom">
                <div class="card-body p-4 p-md-5">
                    <h4 class="card-title mb-4">Send Me a Message</h4>
                    
                    <form id="contactForm" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label fw-semibold">Your Name *</label>
                                <input type="text" class="form-control" id="name" name="name" required placeholder="Enter your full name">
                                <div class="invalid-feedback">Please enter your name.</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label fw-semibold">Email Address *</label>
                                <input type="email" class="form-control" id="email" name="email" required placeholder="Enter your email">
                                <div class="invalid-feedback">Please enter a valid email address.</div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="subject" class="form-label fw-semibold">Subject *</label>
                            <input type="text" class="form-control" id="subject" name="subject" required placeholder="What is this regarding?">
                            <div class="invalid-feedback">Please enter a subject.</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="message" class="form-label fw-semibold">Message *</label>
                            <textarea class="form-control" id="message" name="message" rows="6" required placeholder="Tell me about your project or inquiry..."></textarea>
                            <div class="invalid-feedback">Please enter your message.</div>
                        </div>
                        
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5" id="submitBtn">
                                <i class="fas fa-paper-plane me-2"></i>Send Message
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const contactForm = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const originalBtnText = submitBtn.innerHTML;
    
    if (contactForm) {
        contactForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate form
            if (!contactForm.checkValidity()) {
                e.stopPropagation();
                contactForm.classList.add('was-validated');
                return;
            }
            
            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
            submitBtn.disabled = true;
            
            try {
                // Get form data
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    subject: document.getElementById('subject').value,
                    message: document.getElementById('message').value
                };
                
                // Get CSRF token
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                // Send AJAX request
                const response = await fetch('{% url "portfolio:contact" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Success - show SweetAlert
                    Swal.fire({
                        icon: 'success',
                        title: 'Message Sent!',
                        text: data.message,
                        confirmButtonColor: '#007bff',
                        confirmButtonText: 'Great!',
                        timer: 5000,
                        timerProgressBar: true
                    });
                    
                    // Reset form
                    contactForm.reset();
                    contactForm.classList.remove('was-validated');
                } else {
                    // Error - show SweetAlert
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                        confirmButtonColor: '#dc3545',
                        confirmButtonText: 'Try Again'
                    });
                }
                
            } catch (error) {
                // Network error
                Swal.fire({
                    icon: 'error',
                    title: 'Network Error',
                    text: 'There was a problem sending your message. Please check your connection and try again.',
                    confirmButtonColor: '#dc3545',
                    confirmButtonText: 'OK'
                });
                console.error('Error:', error);
            } finally {
                // Reset button state
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            }
        });
        
        // Real-time validation
        const inputs = contactForm.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                if (this.checkValidity()) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                }
            });
        });
    }
});
</script>

<style>
/* Add some custom styles for form validation */
.is-valid {
    border-color: #28a745 !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.is-invalid {
    border-color: #dc3545 !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4.4-.4'/%3e%3cpath d='M6 7v2'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}
</style>
{% endblock %}